<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="/favicon.png">

    <title>cwrap - nss_wrapper</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="assets/jumbotron.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../docs-assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  <link href="assets/content.css" type="text/css" rel="stylesheet"></head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <!--<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          -->
          <a class="navbar-brand" href="/">cwrap</a>
        </div>
        <!--
        <div class="navbar-collapse collapse">
          <form class="navbar-form navbar-right" role="form">
            <div class="form-group">
              <input placeholder="Email" class="form-control" type="text">
            </div>
            <div class="form-group">
              <input phnomarkers="true" placeholder="Password" class="form-control" type="password"><br><table style="width: 30px;margin: 0;padding: 0"><tr style="margin: 0;padding: 0"><td title="Click for Password Hasher" class="passhash_marker" id="null_passhash_marker_1" style="border: thin solid #80c080;background-color: #eeffee;margin: 0 1px;padding: 0;font: 12px serif;color: #609060;cursor: pointer;min-width: 12px;text-align: center;vertical-align: middle;">#</td></tr></table>
            </div>
            <button type="submit" class="btn btn-success">Sign in</button>
          </form>
        </div>--><!--/.navbar-collapse -->
      </div>
    </div>

    <div class="container">
        <h1>The nss_wrapper library</h1>
        <!-- Example row of columns -->
        <div class="row">
            <div class="col-md-7">
                <p>nss_wrapper - A wrapper for the user, group and hosts NSS API</p>

                <p>
                There are projects that need to be able to create,
                modify, and delete Unix users. Others just switch user
                IDs to interact with the system on behalf of another user
                (e.g. a user space file server). To be able to test these,
                you need the privilege to modify the passwd and group
                files. With nss_wrapper it is possible to define your own
                passwd and group files which will be used by the software
                while it is under test.  The nss_wrapper also allows you
                to create a hosts file to set up name resolution for the
                addresses you use with socket_wrapper.
                </p>

                <h2>Features</h2>
                <ul>
                    <li>Provides information for user and group accounts.</li>
                    <li>Network name resolution using a hosts file.</li>
                    <li>Loading and testing of NSS modules.</li>
                </ul>

                <h2>Detailed descriptions</h2>
                <ul>
                    <li>
                    The user, group, and hosts functionality are all defined
                    as wrappers around the Name Service Switch (NSS) API.
                    </li>

                    <li>For user and group accounts you need to create two
                    files: 'passwd' and 'group'. The format of the passwd file
                    is described in <code>man 5 passwd</code> and the group file
                    in <code>man 5 group</code>. So you can fill these files with
                    made up accounts.
                    You point nss_wrapper to them using the two variables
                    <code>NSS_WRAPPER_PASSWD=/path/to/your/passwd</code> and
                    <code>NSS_WRAPPER_GROUP=/path/to/your/group</code>.</li>

                    <li>If you also need to emulate network name resolution in
                    your enviornment, especially with socket_wrapper, you can
                    write a hosts file. The format is described in <code>man 5
                    hosts</code>. Then you can point nss_wrapper to your hosts file
                    using: <code>NSS_WRAPPER_HOSTS=/path/to/your/hosts</code>
                    </li>

                    <li>If you need to return a hostname which is different
                    from the one of your machine is using you can use:
                    <code>NSS_WRAPPER_HOSTNAME=test.example.org</code></li>

                    <li>If you have a project which also provides user and
                    group information out of a database, you normally write
                    your own nss modules. nss_wrapper is able to load nss
                    modules and ask them first before looking into the faked
                    passwd and group file. To point nss_wrapper to the module
                    you can do that using
                    <code>NSS_WRAPPER_MODULE_SO_PATH=/path/to/libnss_yourmodule.so.</code>
                    As each nss module has a special prefix like
                    <code>_nss_winbind_getpwnam()</code> you need to set the prefix too so
                    nss_wrapper can load the functions with
                    <code>NSS_WRAPPER_MODULE_FN_PREFIX=&lt;prefix&gt;</code>.</li>

                </ul>

                <h2>Example</h2>
<pre>$ echo "bob:x:1000:1000:bob gecos:/home/test/bob:/bin/false" > passwd
$ echo "root:x:65534:65532:root gecos:/home/test/root:/bin/false" >> passwd
$ echo "users:x:1000:" > group
$ echo "root:x:65532:" >> group
$ LD_PRELOAD=libnss_wrapper.so NSS_WRAPPER_PASSWD=passwd \
NSS_WRAPPER_GROUP=group getent passwd bob
bob:x:1000:1000:bob gecos:/home/test/bob:/bin/false
$ LD_PRELOAD=libnss_wrapper.so NSS_WRAPPER_HOSTNAME=test.example.org hostname
test.example.org
$ echo "fd00::5357:5faa test.cwrap.org" > hosts
$ echo "127.0.0.170 test.cwrap.org" >> hosts
# Now query ahostsv6 which returns only IPv6 addresses and
# calls getaddrinfo() for each the entry.
$ LD_PRELOAD="libnss_wrapper.so" NSS_WRAPPER_HOSTS=hosts \
getent ahostsv6 test.cwrap.org
fd00::5357:5faa DGRAM  test.cwrap.org
fd00::5357:5faa STREAM test.cwrap.org
</pre>

            </div> <!-- /col -->
        </div>

       <hr>

       <footer>
           <p>Â© Andreas Schneider 2013</p>
       </footer>
   </div> <!-- /container -->

   <!-- Bootstrap core JavaScript
        ================================================== -->
   <!-- Placed at the end of the document so the pages load faster -->
   <script src="assets/jquery-1.js"></script>
   <script src="assets/bootstrap.min.js"></script>

</body></html>
